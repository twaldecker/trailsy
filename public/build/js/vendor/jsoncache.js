(function(a){var b="JSONCache size",c="JSONCache data ",d="JSONCache time ",e={version:"#VERSION#",debug:!0,numTries:5,waitTime:200,itemLifetime:3e5,maxCacheSize:2621440,autoEvict:!0},f={};f.settings=e;var g=function(){if(e.debug&&window.console){var a=Array.prototype.slice.call(arguments);a.unshift("JSONCache:"),console.log.apply(console,a)}};e.browserOk=function(){var a=window.JSON&&typeof window.JSON.parse=="function"&&typeof window.JSON.stringify=="function",b;try{b="localStorage"in window&&window.localStorage!==null}catch(c){b=!1}return a&&b}();var h=function(a){var c=parseInt(window.localStorage[b],10);c=isNaN(c)?0:c;var d=c+a*2;d>0?window.localStorage[b]=d:window.localStorage.removeItem(b)},i=function(a,b){var g=JSON.stringify(b),i=g.length,j=f._getTime(),k=function(){return f.getCacheSize()+i*2},l=function(){if(k()>e.maxCacheSize){f.clean();if(k()>e.maxCacheSize)throw new Error("Cache add would exceed maxCacheSize ("+k()+" > "+e.maxCacheSize+")")}try{window.localStorage[c+a]=g,window.localStorage[d+a]=j,h(i)}catch(b){throw new Error("Error adding data to localStorage, quota might be full.")}};if(!e.autoEvict){l();return}for(;;)try{l();return}catch(m){if(f.getCacheSize()===0)throw new Error("Cache add would exceed maxCacheSize ("+k()+" > "+e.maxCacheSize+") even after autoEvicting everything");f.purgeOldest()}};f.getCacheSize=function(){var a=parseInt(window.localStorage[b],10);return isNaN(a)?0:a};var j=function(a){var b=parseInt(a,10);return!isNaN(b)&&b+e.itemLifetime>=f._getTime()};f.clear=function(a){if(a){if(window.localStorage[c+a]){var e=window.localStorage[c+a].length;h(-1*e)}window.localStorage.removeItem(c+a),window.localStorage.removeItem(d+a)}else{var f=/^JSONCache (data|time) /,g,i,j=window.localStorage.length,k=[];for(g=0;g<j;++g)i=window.localStorage.key(g),f.test(i)&&k.push(i);j=k.length;for(g=0;g<j;++g)window.localStorage.removeItem(k[g]);window.localStorage.removeItem(b)}},f.clean=function(){var a=/^JSONCache time ([\S]+)$/,b,c,d=[],e,g=window.localStorage.length;for(e=0;e<g;++e)b=window.localStorage.key(e),c=a.exec(b),c&&!j(window.localStorage[b])&&d.push(c[1]);g=d.length;for(e=0;e<g;++e)f.clear(d[e])},f.purgeOldest=function(){var a=/^JSONCache time /,b,c=null,e,g,h=window.localStorage.length;for(var i=0;i<h;++i){e=window.localStorage.key(i);if(!a.test(e))continue;g=parseInt(window.localStorage[e],10),!isNaN(g)&&(c===null||g<c)&&(b=e,c=g)}c!==null&&f.clear(b.replace(d,""))},f._getJSONProxy=function(b,c){a.ajax(b,c)},f._getTime=function(){return(new Date).getTime()},f._tryGetJSON=function(a,b,c,d){if(c>e.numTries){g("Tried fetching",c-1,"times already, returning."),typeof b.ongiveup=="function"&&b.ongiveup("timeout");return}b.error=function(e,h,i){g("Ajax error with status:",h),typeof b.onerror=="function"&&b.onerror(e,h,i,c),window.setTimeout(function(){f._tryGetJSON(a,b,c+1,d*2)},d)},typeof b.ontry=="function"&&b.ontry(c),f._getJSONProxy(a,b)},f.getCachedJSON=function(a,b){b=b||{};var h=b.success,k=window.localStorage[c+a],l=window.localStorage[d+a];k&&j(l)?(g("Value found from cache for url:",a),typeof h=="function"&&h(JSON.parse(k))):(g("Value not found in cache fetching data from url:",a),b.success=function(c){g("Fetched data, adding to cache for url:",a);try{i(a,c)}catch(d){if(typeof b.ongiveup=="function"){b.ongiveup("addfailure");return}}typeof h=="function"&&h(c)},b.dataType="json",f._tryGetJSON(a,b,1,e.waitTime))},window.JSONCache=f})(jQuery)