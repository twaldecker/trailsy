define(["jquery","underscore","backbone","views/detailResultList","views/searchResultList","views/loginDialog","views/signupDialog","views/flashMessage","collections/words","collections/detailWords","i18n!nls/trailsy"],function(a,b,c,d,e,f,g,h,i,j,k){var l=c.Router.extend({loginState:!1,input:a("input#word"),routes:{"":"home",login:"login",logout:"logout",signup:"signup","search/:query/from/:fromLang/to/:toLang":"search","words/:word/targetLang/:lang":"words","validation/:id/code/:code":"validation"},initialize:function(){this.setLoginState(a("#loginLink").hasClass("hidden"))},home:function(){},setLoginState:function(a){this.loginState=a},getLoginState:function(){return this.loginState},checkLoginState:function(){return!1===this.getLoginState()?(this.navigate("login",!0),!1):!0},words:function(a,c){i.getOrFetch(a,b.bind(function(){var b=i.get(a);this.setSearchText(b.get("word"));var e=new j(b.get("translations"));e.url="words/"+a+"/translations",d.setCollection(e),d.render(c)},this)),this.setTargetLangValue(c)},setFromLangValue:function(b){a("#sourceLanguage").val(b)},setTargetLangValue:function(b){var c=a("#targetLanguage");c.val(b)},setSearchText:function(a){this.input.val(a)},search:function(b,c,d){this.input.addClass("loading"),i.fetch({data:jQuery.param({word:b,fromLang:c,toLang:d}),url:"words/search",success:function(){e.render(),a("input#word").removeClass("loading")},error:function(){a("input#word").removeClass("loading")}}),this.setSearchText(b),this.setFromLangValue(c),this.setTargetLangValue(d)},login:function(){f.show()},logout:function(){a.ajax({url:"/log_out",type:"GET",contentType:"application/json; charset=utf-8",beforeSend:function(b){var c=a('meta[name="csrf-token"]').attr("content");c&&b.setRequestHeader("X-CSRF-Token",c)},success:b.bind(function(){a("#logoutLink").addClass("hidden"),a("#loginLink").removeClass("hidden"),a("#signupLink").removeClass("hidden"),this.setLoginState(!1),h.showMessage("info",k.logout_success)},this),error:b.bind(console.log,this)})},signup:function(){console.log("show signup dialog"),g.show()},validation:function(c,d){a.ajax({url:"/user/"+c+"/validate/"+d,type:"GET",contentType:"application/json; charset=utf-8",beforeSend:function(b){var c=a('meta[name="csrf-token"]').attr("content");c&&b.setRequestHeader("X-CSRF-Token",c)},success:b.bind(console.log,"success"),error:b.bind(console.log,"failure")})}}),m=function(){window.AppRouter=new l,c.history.start({pushStack:!0})};return{init:m}})