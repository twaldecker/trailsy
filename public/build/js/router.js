define(["jquery","underscore","backbone","views/detailResultList","views/searchResultList","views/loginDialog","views/signupDialog","views/flashMessage","collections/words","collections/translations","i18n!nls/trailsy","text!templates/backButton.html"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=c.Router.extend({loginState:!1,input:a("input#word"),routes:{"":"home",login:"login",logout:"logout",signup:"signup","search/:query/from/:fromLang/to/:toLang":"search","words/:word/targetLang/:lang":"words","validation/:id/code/:code":"validation"},initialize:function(){this.setLoginState(a("#loginLink").hasClass("hidden"))},home:function(){},setLoginState:function(a){this.loginState=a},getLoginState:function(){return this.loginState},checkLoginState:function(){return!1===this.getLoginState()?(this.navigate("login",!0),!1):!0},slideToDetailView:function(c){a("#translations").css("-webkit-transform","translate(0px, 0px)"),a("#search, #user").css("-webkit-transform","translate(-480px, 0px)");var f=this;setTimeout(function(){var g=b.template(l),h=a("nav").append(g(k));a(".back",h).on("click",b.bind(f.onClickBack,f)),a("#search, #user").addClass("hidden"),e.unrender(),e.hide(),d.render(c)},500)},words:function(c,e){i.getOrFetch(c,b.bind(function(){var b=i.get(c);this.setSearchText(b.get("word")),this.setFromLangValue(b.get("language_id"));var f=new j(b.get("translations"));f.url="words/"+c+"/translations",d.setCollection(f),!0===a.browser.mobile?this.slideToDetailView(e):d.render(e)},this)),this.setTargetLangValue(e)},onClickBack:function(b){b.preventDefault(),b.stopPropagation(),a("#translations, .back").css("-webkit-transform","translate(480px, 0px)"),setTimeout(function(){a(".back").remove(),a("#search, #user").removeClass("hidden"),a("#search, #user").css("-webkit-transform","translate(0px, 0px)")},500)},setFromLangValue:function(b){a("#sourceLanguage").val(b)},setTargetLangValue:function(b){var c=a("#targetLanguage");c.val(b)},setSearchText:function(a){this.input.val(b.escape(a))},search:function(b,c,d){this.input.addClass("loading"),i.fetch({data:jQuery.param({word:b,fromLang:c}),url:"words/search",success:function(){e.render(),a("input#word").removeClass("loading")},error:function(){a("input#word").removeClass("loading")}}),this.setSearchText(b),this.setFromLangValue(c),this.setTargetLangValue(d)},login:function(){f.show()},logout:function(){f.logout()},signup:function(){g.show()},validation:function(a,b){g.validation(a,b)}}),n=function(){window.AppRouter=new m,c.history.start({pushStack:!0})};return{init:n}})