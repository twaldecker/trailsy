define(["jquery","underscore","text!templates/addWord.html","i18n!nls/trailsy"],function(a,b,c,d){var e={collection:null,addWordHtml:null,setCollection:function(a){this.collection=a},applyTemplate:function(){var e=a("input#word").val(),f={addWordHeading:d.addTranslationFor+" "+e,word:d.word,example:d.example,add:d.add,sentence:d.sentence};"addWord"===this.dialogType&&(f.addWordHeading=d.addWord);var g=b.template(c);this.addWordHtml=a(g(f));var h=parseInt(a("#targetLanguage").val(),10),i=a("#sourceLanguage"),j=parseInt(i.val(),10);if("addWord"===this.dialogType&&1===j||"addTranslation"===this.dialogType&&1===h){var k=a('<label for="sourceLanguage">'+d.lang+"</label>");a("#addword_example",this.addWordHtml).after(k);var l=i.clone();a('[value="1"]',l).remove(),l.attr("id","addword_language"),k.after(l),l.val(h),"addWord"===this.dialogType?(l.val(i.val()),a("#addword_word",this.addWordHtml).val(e)):1!==j&&a('[value="'+j+'"]',l).remove()}},appendDiv:function(){a("nav").append(this.addWordHtml)},setDialogType:function(a){this.dialogType=a},show:function(){this.applyTemplate(),this.appendDiv(),this.addWordHtml.fadeIn(300);var c=(this.addWordHtml.height()+24)/2,d=(this.addWordHtml.width()+24)/2;this.addWordHtml.css({"margin-top":-c,"margin-left":-d}),"addWord"===this.dialogType?a("#addword_example",this.addWordHtml).focus():a("#addword_word",this.addWordHtml).focus(),a("#addWord-box .closeButton").on("click",b.bind(this.hide,this)),a("#addWord-box form").on("submit",b.bind(this.submitForm,this))},saveSuccess:function(a){"addWord"===this.dialogType&&AppRouter.navigate("words/"+a.id,!0),this.hide()},saveFailed:function(b){(b.status==401||b.status==403)&&AppRouter.navigate("login",!0),a("#addWord-box .error").removeClass("hidden"),a("#addWord-box .error").text("An Error occured.")},hide:function(){a("input",this.addWordHtml).val(""),a("#addWord-box").fadeOut(300,b.bind(function(){this.addWordHtml.remove()},this)),a("#addWord-box .closeButton").unbind(),a("#addWord-box form").unbind()},getLanguageId:function(){var b=a("#addword_language",this.addWordHtml).val();return undefined!=b?b:a("#targetLanguage").val()},submitForm:function(){var c={word:a("#addword_word",this.addWordHtml).val(),example:a("#addword_example",this.addWordHtml).val(),language_id:this.getLanguageId()},d={success:b.bind(this.saveSuccess,this),error:b.bind(this.saveFailed,this)};"addWord"===this.dialogType&&(d.silent=!0),this.collection.addOrUpdate(c,d)}};return e})