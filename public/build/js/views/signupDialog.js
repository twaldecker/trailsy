define(["jquery","underscore","text!templates/signup.html"],function(a,b,c){var d={signupHtml:null,appendDiv:function(){this.signupHtml=a(c),a("nav").append(this.signupHtml)},show:function(){null===this.signupHtml&&this.appendDiv(),this.signupHtml.fadeIn(300);var c=(this.signupHtml.height()+24)/2,d=(this.signupHtml.width()+24)/2;this.signupHtml.css({"margin-top":-c,"margin-left":-d}),a("body").append('<div id="mask"></div>'),a("#mask").fadeIn(300),a("a.closeButton, #mask").on("click",b.bind(this.hide,this)),a("#signup-box form").on("submit",b.bind(this.submitForm,this))},signupSuccess:function(b){console.log(b),a("#signup-box div.error",this.loginHtml).hide(),this.hide()},signupError:function(){a("#signup-box div.error",this.loginHtml).text("Wrong Username or Password"),a("#signup-box div.error",this.loginHtml).show()},hide:function(){a("#mask , #signup-box").fadeOut(300,b.bind(function(){a("#signup-box div.error",this.loginHtml).hide(),a("a.closeButton. #mask").unbind(),a("#mask").remove()},this)),a("#signup-box form").unbind(),AppRouter.navigate("home",!0)},submitForm:function(){var c=a("#signup-box form",this.loginHtml);if(c.length){var d=c.serialize();a.ajax({url:"/users",data:d,type:"POST",beforeSend:function(b){var c=a('meta[name="csrf-token"]').attr("content");c&&b.setRequestHeader("X-CSRF-Token",c)},success:b.bind(this.signupSuccess,this,d),error:b.bind(this.signupError,this)})}}};return d})