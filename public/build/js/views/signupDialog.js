define(["jquery","underscore","text!templates/signup.html","views/flashMessage","i18n!nls/trailsy"],function(a,b,c,d,e){var f={signupHtml:null,mask:a("#mask"),errorDiv:null,form:null,show:function(){if(null===this.signupHtml){var d=b.template(c);this.signupHtml=a(d(e)),a("nav").append(this.signupHtml),this.errorDiv=a("#signup-box .error"),this.form=a("#signup-box form")}this.signupHtml.css({"margin-top":(this.signupHtml.height()+24)/-2,"margin-left":(this.signupHtml.width()+24)/-2}),this.signupHtml.fadeIn(300),this.mask.fadeIn(300),a("#signup-box a, #mask").on("click",b.bind(this.hide,this)),this.form.on("submit",b.bind(this.submitForm,this))},hide:function(){a("#mask , #signup-box").fadeOut(300,b.bind(function(){this.mask.unbind(),this.form.unbind(),a("#signup-box form input").val(""),this.errorDiv.hide()},this)),AppRouter.navigate("home",!0)},submitForm:function(){this.form.length&&a.ajax({url:"/users",data:this.form.serialize(),type:"POST",beforeSend:b.bind(function(b){var c=a('meta[name="csrf-token"]').attr("content");c&&b.setRequestHeader("X-CSRF-Token",c),this.errorDiv.empty(),this.errorDiv.hide()},this),success:b.bind(this.signupSuccess,this),error:b.bind(this.signupError,this)})},signupSuccess:function(){d.showMessage("info",e.signup_aftersubmit),this.hide()},signupError:function(c,d,f){var g=a.parseJSON(c.responseText),h=a("<ul></ul>");b.each(g,function(c,d){var f=a("<li>");f.text(d),h.append(f),b.each(c,function(b){var c=a("<p>").text(e[b]);f.append(c)})}),this.errorDiv.append(h),this.errorDiv.show()}};return f})