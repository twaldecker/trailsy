define(["jquery","underscore","text!templates/login.html"],function(a,b,c){var d={loginHtml:null,appendDiv:function(){this.loginHtml=a(c),a("nav").append(this.loginHtml)},show:function(){null===this.loginHtml&&this.appendDiv(),this.loginHtml.fadeIn(300);var c=(this.loginHtml.height()+24)/2,d=(this.loginHtml.width()+24)/2;this.loginHtml.css({"margin-top":-c,"margin-left":-d}),a("body").append('<div id="mask"></div>'),a("#mask").fadeIn(300),a("a.closeButton, #mask").on("click",b.bind(this.hide,this)),a("#login-box form").on("submit",b.bind(this.submitForm,this))},loginSuccess:function(b){console.log(b),a("#login-error",this.loginHtml).hide(),this.hide(),a("#loginLink").addClass("hidden"),a("#logoutLink").removeClass("hidden"),a("#signupLink").addClass("hidden"),AppRouter.setLoginState(!0)},loginFailed:function(){a("#login-box .error").text("Wrong Username or Password"),a("#login-box .error").show()},hide:function(){a("#mask , #login-box").fadeOut(300,b.bind(function(){a("#login-error",this.loginHtml).hide(),a("a.closeButton, #mask").unbind(),a("#mask").remove()},this)),a("#login-box form").unbind(),AppRouter.navigate("home",!0)},submitForm:function(){var c=a("#login-box form");if(c.length){var d=c.serialize();a.ajax({url:"/sessions",data:d,type:"POST",beforeSend:function(b){var c=a('meta[name="csrf-token"]').attr("content");c&&b.setRequestHeader("X-CSRF-Token",c)},success:b.bind(this.loginSuccess,this,d),error:b.bind(this.loginFailed,this)})}}};return d})