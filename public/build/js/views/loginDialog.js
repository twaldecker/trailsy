define(["jquery","underscore","text!templates/login.html","views/flashMessage","i18n!nls/trailsy"],function(a,b,c,d,e){var f={loginHtml:null,appendDiv:function(){var d=b.template(c);this.loginHtml=a(d(e)),a("nav").append(this.loginHtml)},show:function(){null===this.loginHtml&&this.appendDiv(),a("#login-box .error").addClass("hidden"),this.loginHtml.fadeIn(300);var c=(this.loginHtml.height()+24)/2,d=(this.loginHtml.width()+24)/2;this.loginHtml.css({"margin-top":-c,"margin-left":-d}),a("#mask").fadeIn(300),a("#login-box a, #mask").on("click",b.bind(this.hide,this)),a("#login-box form").on("submit",b.bind(this.submitForm,this))},loginSuccess:function(b){console.log(b),a("#login-box .error",this.loginHtml).addClass("hidden"),this.hide(),a("#loginLink").addClass("hidden"),a("#logoutLink").removeClass("hidden"),a("#signupLink").addClass("hidden"),d.showMessage("info",e.login_success),AppRouter.setLoginState(!0)},loginFailed:function(){a("#login-box .error").text("Wrong Username or Password"),a("#login-box .error").removeClass("hidden")},hide:function(){a("#mask , #login-box").fadeOut(300,b.bind(function(){a("#login-box .error",this.loginHtml).addClass("hidden"),a("#login-box form input").val(""),a("#login-box a.closeButton, #mask").unbind(),a("#login-box form").unbind()},this)),AppRouter.navigate("home",!0)},submitForm:function(){var c=a("#login-box form");if(c.length){var d=c.serialize();a.ajax({url:"/sessions",data:d,type:"POST",beforeSend:function(b){var c=a('meta[name="csrf-token"]').attr("content");c&&b.setRequestHeader("X-CSRF-Token",c)},success:b.bind(this.loginSuccess,this,d),error:b.bind(this.loginFailed,this)})}}};return f})