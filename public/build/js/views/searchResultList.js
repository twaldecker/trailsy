define(["jquery","underscore","backbone","views/searchResult","views/detailResultList","views/addWordDialog","i18n!nls/trailsy","collections/words"],function(a,b,c,d,e,f,g,h){var i=c.View.extend({el:a("#searchResults"),collection:null,targetLang:"1",searchTimeout:null,events:{"keydown #searchInput":"keyDown","keyup #searchInput":"keyUp","search #searchInput":"search","blur #searchInput":"blur","focus #searchInput":"focus","change #targetLanguage":"changeLang","mousedown #addWord":"onClickAdd"},initialize:function(){this.items_element=a("#searchResultList"),b.bindAll(this,"unrender","render","search","changeLang","appendItem","focus","blur","keyDown","keyUp","delayedSearch","setTargetLang","onClickAdd"),this.collection=h,this.collection.bind("refresh",this.render),this.collection.bind("add",this.render)},setTargetLang:function(a){this.targetLang=a},onClickAdd:function(a){a.preventDefault(),a.stopPropagation(),f.setCollection(this.collection),f.setDialogType("addWord"),f.show(!0)},changeLang:function(){this.targetLang=a("#targetLanguage").val(),this.search(),console.log("selected lang: "+this.targetLang)},focus:function(){},blur:function(){this.items_element.addClass("hidden");var a=this.items_element.children("li.selected");a.length&&a.removeClass("selected")},keyUp:function(a){if(a.keyCode==27||a.keyCode==13||a.keyCode==9||a.keyCode==40||a.keyCode==38)return!0;this.delayedSearch()},delayedSearch:function(){this.searchTimeout&&clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(b.bind(function(){this.search()},this),350)},search:function(){this.searchTimeout&&clearTimeout(this.searchTimeout);var b=a("#searchInput"),c=b.val();if(c.length<3)return this.blur(),AppRouter.navigate("home",!0),!0;AppRouter.navigate("search/"+c+"/targetLang/"+this.targetLang,!0)},keyDown:function(b){if(b.keyCode==27)return b.preventDefault(),this.blur(),AppRouter.navigate("home",!0),!1;if(b.keyCode==13||b.keyCode==9){var c=this.items_element.children("li.selected");if(c.length){var d=c.attr("data-id");return AppRouter.navigate(this.collection.url+"/"+parseInt(d,10)+"/targetLang/"+this.targetLang,!0),a("#searchInput").blur(),!1}return this.search(),!0}if(b.keyCode==40){b.preventDefault();var c=this.items_element.children("li.selected");return c.length==0?this.items_element.children("li:first").addClass("selected"):c==this.items_element.children("li:last")?c.removeClass("selected"):c.removeClass("selected").next("li").addClass("selected"),!1}if(b.keyCode==38){b.preventDefault();var c=this.items_element.children("li.selected");return c.length==0?this.items_element.children("li:last").addClass("selected"):c==this.items_element.children("li:first")?c.removeClass("selected"):c.removeClass("selected").prev("li").addClass("selected"),!1}return!0},appendAddWordLink:function(){var b=a("#searchInput").val();this.el.append('<a href="#" id="addWord">'+g.add+" "+g.word+" "+b+"</a>")},unrender:function(){this.items_element.html(""),a("#addWord",this.el).remove(),e.unrender()},appendItem:function(b){var c=new d({model:b}),e=c.render().el,f=this;a(e).on("mousedown",function(){AppRouter.navigate(f.collection.url+"/"+b.get("id")+"/targetLang/"+f.targetLang,!0)}),this.items_element.append(e)},render:function(){this.unrender(),this.items_element.removeClass("hidden"),a("#searchInput").focus(),0===this.collection.length&&this.appendAddWordLink(),this.collection.each(function(a){this.appendItem(a)},this)}});return new i})