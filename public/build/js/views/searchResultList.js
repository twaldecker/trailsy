define(["jquery","underscore","backbone","views/searchResult","views/detailResultList","views/addWordDialog","i18n!nls/trailsy","collections/words"],function(a,b,c,d,e,f,g,h){var i=c.View.extend({el:a("#search"),input:a("input#word"),collection:null,searchTimeout:null,events:{"keydown input#word":"keyDown","keyup input#word":"keyUp","search input#word":"search","blur input#word":"blur","focus input#word":"focus","change #sourceLanguage, #targetLanguage":"changeLang","mousedown #addWord":"onClickAdd"},initialize:function(){this.items_element=a("ul#result"),b.bindAll(this,"unrender","render","search","changeLang","appendItem","focus","blur","keyDown","keyUp","delayedSearch","onClickAdd"),this.collection=h,this.collection.bind("refresh",this.render),this.collection.bind("add",this.render)},onClickAdd:function(a){a.preventDefault(),a.stopPropagation(),f.setCollection(this.collection),f.setDialogType("addWord"),f.show(!0)},changeLang:function(){this.search()},focus:function(){},blur:function(){!1===a.browser.mobile&&(this.items_element.addClass("hidden"),a("#addWord",this.el).remove());var b=this.items_element.children("li.selected");b.length&&b.removeClass("selected")},keyUp:function(a){if(a.keyCode==27||a.keyCode==13||a.keyCode==9||a.keyCode==40||a.keyCode==38)return!0;this.delayedSearch()},delayedSearch:function(){this.searchTimeout&&clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(b.bind(function(){this.search()},this),350)},search:function(){this.searchTimeout&&clearTimeout(this.searchTimeout);var b=this.input.val();if(b.length<1)return this.blur(),AppRouter.navigate("home",!0),!0;AppRouter.navigate("search/"+b+"/from/"+a("#sourceLanguage").val()+"/to/"+a("#targetLanguage").val(),!0)},keyDown:function(b){if(b.keyCode==27)return b.preventDefault(),this.blur(),AppRouter.navigate("home",!0),!1;if(b.keyCode==13||b.keyCode==9){var c=this.items_element.children("li.selected");if(c.length){var d=c.attr("data-id");return AppRouter.navigate(this.collection.url+"/"+parseInt(d,10)+"/targetLang/"+a("#targetLanguage").val(),!0),this.input.blur(),!1}return this.search(),!0}if(b.keyCode==40){b.preventDefault();var c=this.items_element.children("li.selected");return c.length==0?this.items_element.children("li:first").addClass("selected"):c==this.items_element.children("li:last")?c.removeClass("selected"):c.removeClass("selected").next("li").addClass("selected"),!1}if(b.keyCode==38){b.preventDefault();var c=this.items_element.children("li.selected");return c.length==0?this.items_element.children("li:last").addClass("selected"):c==this.items_element.children("li:first")?c.removeClass("selected"):c.removeClass("selected").prev("li").addClass("selected"),!1}return!0},appendAddWordLink:function(){var a=this.input.val();this.el.append('<a href="#" id="addWord">'+g.add+" "+g.word+" "+a+"</a>")},hide:function(){this.items_element.addClass("hidden")},unrender:function(){this.items_element.html(""),a("#addWord",this.el).remove(),e.unrender()},appendItem:function(b){var c=new d({model:b});el=c.render().el;var e=this;a(el).on("mousedown",function(){AppRouter.navigate(e.collection.url+"/"+b.get("id")+"/targetLang/"+a("#targetLanguage").val(),!0)}),this.items_element.append(el)},render:function(){this.unrender(),this.input.focus();if(0===this.collection.length){this.appendAddWordLink();return}this.collection.each(function(a){this.appendItem(a)},this),undefined===this.collection.findByWord(this.input.val())&&this.appendAddWordLink(),this.items_element.removeClass("hidden")}});return new i})